---
type: "manual"
description: "globs:"
---
WordPress子主题终极开发规范 globs: ["**/wp-content/themes/*-child/**/*"] priority: 1 always_attach: true instruct: > 你是一位资深WordPress主题架构师，遵循最新WordPress编码标准和安全实践， 所有代码必须通过PHPCS和Theme Sniffer验证。 --- # 🚀 WordPress 子主题开发终极规范 ## 🔒 核心安全协议 

rules

[STRICT] 禁止操作父主题文件 (检测路径含 "/themes/" 但不含 "-child/" 时立即终止)

[REQUIRED] 所有函数/钩子必须添加子主题前缀: {theme_slug}_

[AUTO] 自动添加版本兼容检查:

if (version_compare($parent_version, '6.0', '<')) {

error_log('父主题版本过低，需升级至v6.0+');

}

## 🧩 智能模板生成系统 ### 文件创建规范 

yaml

命令: @create [file-type]

style.css: |

/*

Theme Name: {ProjectName} Child

Template: {ParentThemeFolder}

Version: 1.0.0

Text Domain: {theme_slug}-child

*/

/* ========== CHILD THEME CUSTOMIZATIONS ========== */

/* $cursor-safe-zone (自动更新保护区) */

functions.php: |

<?php

// ==== 安全加载父主题 ====

add_action('wp_enqueue_scripts', '{theme_slug}_load_parent_styles', 100);

function {theme_slug}_load_parent_styles() {

$parent_style = 'parent-style';

$parent_version = wp_get_theme()->parent()->get('Version');

// 核心加载逻辑 wp_enqueue_style($parent_style, get_template_directory_uri() . '/style.css', array(), $parent_version ); // 自动创建子主题样式依赖链 wp_enqueue_style('child-style', get_stylesheet_uri(), array($parent_style), // 显式依赖父样式 wp_get_theme()->get('Version') ); 

}

// ==== 新增功能区 ====

/* $cursor-editable-region */

## 🛡️ AI 行为约束引擎 

logic

BEFORE CODING:

自动扫描父主题版本 (通过 style.css)

检查目标文件是否已存在覆盖标记

DURING CODING:

PHP覆盖文件必须添加:

/**

OVERRIDE PROTECTION v3

原始文件: {parent_file_path}

修改摘要: {用户描述}

父主题版本兼容性: {parent_version}+

*/

自动生成文档测试用例:

AFTER CODING:

自动添加多浏览器测试提示:

## 💎 最佳实践增强器 ### CSS 优化体系 

scss

// 响应式覆盖系统 (自动生成)

{parent_selector} {

--child-header-height: 100px; // 使用CSS变量

@media (max-width: 768px) { --child-header-height: 80px; // 移动端适配 } @media (max-width: 480px) { --child-header-height: 60px; } 

}

// 禁止直接修改父选择器

body .parent-selector {

/* $cursor-alert: 直接修改父选择器有风险! */

}

### PHP 高级模式 

php

<?php

// 智能设置重写系统

add_filter('theme_mod{option_name}', '{theme_slug}custom_override');

function {theme_slug}_custom_override($value) {

// 自动生成防御性代码

$new_value = apply_filters('child_custom_value', null);

return new_value ?? value; // 空值合并保护

}

// 自动注入环境检测

if (!defined('CHILD_THEME_SAFE_MODE')) {

define('CHILD_THEME_SAFE_MODE', true);

add_action('admin_notices', function() {

echo '<div class="notice notice-success">

<p>子主题安全模式已激活 (v{child_version})</p>

</div>';

});

}

## 🔍 自动审计模块 

security

AUTO-CHECK:

[版本] 验证Template: 是否匹配父主题文件夹

[安全] 扫描未过滤的 _GET/_POST

[性能] CSS权重检查 (!important 超3次警告)

[规范] 函数前缀一致性 (>95%)

// 审计命令: @audit

REPORT:

核心文件完整性: 100%

安全风险: 0

规范违反: 1 (前缀缺失)

## 🧪 智能调试系统 

php

// 增强版错误处理

add_action('wp_footer', '{theme_slug}_debug_panel');

function {theme_slug}_debug_panel() {

if (WP_DEBUG && current_user_can('administrator')) {

echo '<div id="child-debug-panel">';

echo '<h4>子主题调试器 (v{child_version})</h4>';

echo '<pre>覆盖文件数: '.count(get_overridden_files()).'</pre>'; // 自动生成

echo '</div>';

}

}


--- @config { "theme_slug": "auto_detect", "parent_selector": "auto_detect_header", "audit_level": "strict" } @version 3.0
