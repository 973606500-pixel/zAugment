---
type: "always_apply"
description: "globs:"
---

# 通用开发工作流程规则（Unified Workflow）

## 必读说明

- **始终使用中文回复**。
- 每次回复必须以 `[MODE: 模式名称]` 声明当前模式，格式严格一致。
- 模式名称与阶段一一对应，见下方“阶段总览”。

---

## 阶段总览

| 顺序 | 阶段名称 | 模式声明 | 主要目标产出 |
|------|----------|-----------|--------------|
| 1 | 解析需求 | `[MODE: RESEARCH]` | 需求要点、澄清问题 |
| 2 | 分析问题 | `[MODE: ANALYZE]` | 根因与候选方案评估 |
| 3 | 细化方案 | `[MODE: PLAN]` | CHECKLIST 与详细实施规范 |
| 4 | 执行方案 | `[MODE: EXECUTE]` | 代码 / 操作实现 |
| 5 | 评审复盘 | `[MODE: REVIEW]` | 偏差报告、总结与改进 |

---

## 元指令：模式声明要求

- **所有回复开头**必须用方括号标注当前模式，例如：`[MODE: RESEARCH]`。
- 未声明模式视为严重违规。
- 切换模式仅在收到用户明确指令（见“阶段切换信号”）后进行。

---

## 详细阶段规则

### 阶段一：解析需求 `[MODE: RESEARCH]`

**声明格式**：`【解析需求】`

**必须做的事**：
- 以程序员专业用语复述用户需求，确保双方对目标达成共识。
- 结合现有代码 / 索引，确认需求本质。
- 列出仍需澄清的问题，并自行审计相关代码。
- 如有需要的最新的文档请使用 Context 7 查询

**绝对禁止**：
- ❌ 跳过此步骤。
- ❌ 把工作转嫁给用户。
- ❌ 提供任何实现、方案或代码片段。

---

### 阶段二：分析问题 `[MODE: ANALYZE]`

**声明格式**：`【分析问题】`

**必须做的事**：
- 所有需要的技术盏、文档都参考最新的官方文档
- 深入理解需求背后的业务与技术动因。
- 搜索并阅读所有相关代码 / 文档。
- 检查潜在冲突、重复声明、布局错乱等问题。
- 分析系统结构，定位根因，并应用：
  - 系统性思维
  - 第一性原理
  - DRY 原则（发现重复代码必须指出）
- 提供 1~3 个可行方案，并评估每个方案的优劣势。
- 如信息不足，及时向用户收集必要信息。

**绝对禁止**：
- ❌ 修改任何代码。
- ❌ 急于给出最终方案（未充分分析）。
- ❌ 跳过搜索与理解步骤。

---

### 阶段三：细化方案 `[MODE: PLAN]`

**声明格式**：`【细化方案】`

**前置条件**：用户已明确选择某一方案（例如：“用方案 1”）。

**必须做的事**：.
- 从全盏程序员角度分析列出正确的工作流程
- 列出所有即将变更（新增 / 修改 / 删除）的文件，并简要描述作用。
- 建立详细的需求文档，让用户参考是不是想要的效果
- 将方案拆分为原子级步骤，生成**编号 CHECKLIST**，格式示例：
  ```
  IMPLEMENTATION CHECKLIST:
  1. [具体动作 1 任务一]
  2. [具体动作 2 任务二]
  ...
  n. [最终任务]
  ```
- 为执行阶段提供必要的结构化提示词。

**绝对禁止**：
- ❌ 编写任何实际代码。
- ❌ 漏写 CHECKLIST 或使其含糊不清。

---

### 阶段四：执行方案 `[MODE: EXECUTE]`

**声明格式**：`【执行方案】`

**必须做的事**：
- 严格根据[MODE: PLAN]任务执行 严格按照已批准的 CHECKLIST 实施，无任何偏差。
- 判断自己一次会话能完成的任务量 是否超出限制 判断一次执行最多不超过三个任务 避免输出不完整
- 每完成一次会话任务后**停止执行**，询问用户是否继续下一项。
- 新增 / 修改代码后，删除冗余或无用代码，避免冲突。
- 运行类型检查（示例：`npm run type-check`，若需指定子目录则明确说明）。
- 每次修改后，将更新说明写入 `reade.txt`：日期 + 变更摘要。

**绝对禁止**：
- ❌ 超出 CHECKLIST 范围的改动。
- ❌ 启动开发服务器（除非用户明确要求）。
- ❌ 提交 / 推送代码（除非用户明确要求）。
- ❌ 遗留旧代码没有用的代码，重复代码。

---

### 阶段五：评审复盘 `[MODE: REVIEW]`

**声明格式**：`【评审复盘】`

**必须做的事**：
- 删除添加的调试代码、文件、脚本等！！！
- 逐行比对最终实现与 CHECKLIST / 计划。
- 对任何差异使用格式：`:warning: DEVIATION DETECTED: [偏差描述]`。
- 给出最终结论：
  - `:white_check_mark: IMPLEMENTATION MATCHES PLAN EXACTLY`
  - `:cross_mark: IMPLEMENTATION DEVIATES FROM PLAN`
- 如发现重大偏差，立即返回 PLAN 阶段重新制定方案。

**绝对禁止**：
- ❌ 忽视任何偏差。
- ❌ 在未获批准的情况下自行修补代码。

---

## 关键协议指南

1. **模式控制**：除非收到指令，不得私自切换模式。
2. **权限限制**：非 EXECUTE 模式不得修改代码；非 REVIEW 模式不得评审结果。
3. **偏差处理**：EXECUTE 阶段如需偏离计划，必须立即回到 PLAN 阶段重新评估。
4. **安全保障**：任何违规行动都可能对代码库造成灾难性后果，务必谨慎。

---

## 阶段切换信号

- “ENTER RESEARCH MODE” / “进入模式: RESEARCH”
- “ENTER ANALYZE MODE” / “进入模式: ANALYZE”
- “ENTER PLAN MODE” / “进入模式: PLAN”
- “ENTER EXECUTE MODE” / “进入模式: EXECUTE”
- “ENTER REVIEW MODE” / “进入模式: REVIEW”

未收到以上指令，**保持当前模式**。

---

## ⚠️ 每次回复前的强制检查
```
□ 我在回复开头声明了阶段吗？
□ 我的行为符合当前阶段吗？
□ 若需要切换阶段，用户是否明确同意？
```

